}
length(list)
nrow(list)
View(list)
for (i in 1:nrow(list)) {
#create load dataframes
temp_low <- fread(paste0(DIR,IN,"res_load\\LOW\\", list[i,10],".csv"), col.names=c("V","load"))
temp_low <- do.call("rbind", replicate(9,temp_low, simplify = FALSE))
temp_med <- fread(paste0(DIR,IN,"res_load\\BASE\\", list[i,10],".csv"), col.names=c("V","load"))
temp_med <- do.call("rbind", replicate(9,temp_med, simplify = FALSE))
temp_high <- fread(paste0(DIR,IN,"res_load\\HIGH\\", list[i,10],".csv"), col.names=c("V","load"))
temp_high <- do.call("rbind", replicate(9,temp_high, simplify = FALSE))
#create solar dataframe
sol <- fread(paste0(DIR,IN,"sol_data\\", list[i,3],"_", list[i,4],".csv"))
#convert local to time element
sol$time <- as.POSIXct(strptime(sol$local_time_stor, "%Y-%m-%d %H:%M:%S"))
sol$year <- format(sol$time, "%Y")
sol$month <- format(sol$time, "%m")
sol$day <- format(sol$time, "%d")
sol$hour <- format(sol$time, "%H")
sol <- sol[,c(5,6,7,8,3)]
sol <- sol[complete.cases(sol), ]
#create appended table
year <- c("2008","2009","2010","2011","2012","2013","2014","2015","2016")
month <- c("03","03","03","03","03","03","03","03","03")
day <- c("09","08","14","13","11","10","09","08","13")
hour <- c("02","02","02","02","02","02","02","02","02")
generation <- c(0,0,0,0,0,0,0,0,0)
add <- data.frame(year,month,day,hour,generation)
sol<- rbind(sol,add)
#drop feb 29 data (maybe by dropping duplicates)
sol1 <- sol %>% group_by(year,month, day, hour) %>% summarise(gen = mean(generation))
#merge columns and write table
dt <- cbind(sol1[,5], temp_med[,2])
write.csv(dt, paste0(DIR, IN,"all_data\\BASE_", list[i,3],"_", list[i,4],".csv"))
dt <- cbind(sol1[,5], temp_high[,2])
write.csv(dt, paste0(DIR, IN,"all_data\\HIGH_", list[i,3],"_", list[i,4],".csv"))
dt <- cbind(sol1[,5], temp_low[,2])
write.csv(dt, paste0(DIR, IN,"all_data\\LOW_", list[i,3],"_", list[i,4],".csv"))
}
warnings()
# Clear workspace
rm(list = ls())
# Packages
library(pacman)
p_load(magrittr, dplyr, stringr, ggplot2,data.table, ggmap, usmap, mapproj)
# Set working directory
DIR <- "C:\\Users\\Will\\GoogleDrive\\UCBerkeley\\Research\\Papers\\2018 Off-grid\\Analysis\\"
OUT = "out"
INPUT = "in"
##########################################################
## II. TMY correlation analysis ##########################
##########################################################
list <- list.files(paste0(DIR,IN, "\\TMY"))
# Set working directory
DIR <- "C:\\Users\\Will\\GoogleDrive\\UCBerkeley\\Research\\Papers\\2018 Off-grid\\Analysis\\"
OUT = "out"
IN = "in"
##########################################################
## II. TMY correlation analysis ##########################
##########################################################
list <- list.files(paste0(DIR,IN, "\\TMY"))
tmy <- fread(paste0(DIR,INPUT,"\\TMY\\", list[i],".csv"))
i = 1
tmy <- fread(paste0(DIR,INPUT,"\\TMY\\", list[i],".csv"))
tmy <- fread(paste0(DIR,INPUT,"\\TMY\\", list[i]))
tmy <- fread(paste0(DIR,INPUT,"\\TMY\\", list[i]),skip=1)
View(tmy)
View(tmy)
tmy$month <- substr(tmy$`Date (MM/DD/YYYY)`,1,2)
View(tmy)
tmy$year <-  substr(tmy$`Date (MM/DD/YYYY)`, nchar(tmy$`Date (MM/DD/YYYY)`)-4+1,
nchar(tmy$`Date (MM/DD/YYYY)`))
View(tmy)
values <- unique(tmy[c("year","month")])
values <- unique(tmy[c("year","month"),])
values <- unique(tmy[,c("year","month")])
View(values)
View(values)
load_clean <- as.numeric(str_extract(list, "\\-*\\d+\\.*\\d*"))
names <- as.numeric(str_extract(list, "\\-*\\d+\\.*\\d*"))
values$id <- names[i]
View(values)
length(list)
collect <- vector("list",length(list))
list <- list.files(paste0(DIR,IN, "\\TMY"))
names <- as.numeric(str_extract(list, "\\-*\\d+\\.*\\d*"))
collect <- vector("list",length(list))
for (i in 1:length(list)) {
#get tmy data
tmy <- fread(paste0(DIR,INPUT,"\\TMY\\", list[i]),skip=1)
tmy$month <- substr(tmy$`Date (MM/DD/YYYY)`,1,2)
tmy$year <-  substr(tmy$`Date (MM/DD/YYYY)`, nchar(tmy$`Date (MM/DD/YYYY)`)-4+1,
nchar(tmy$`Date (MM/DD/YYYY)`))
#subset data of interest
values <- unique(tmy[,c("year","month")])
values$id <- names[i]
#store values
collect[[i]] <- values
}
df <- do.call(cbind, collect)
View(df)
df <- do.call(rbind, collect)
View(df)
saveRDS(tmy_dates,paste0(DIR,OUT, "\\tmy_dates"))
tmy_dates <- do.call(rbind, collect)
saveRDS(tmy_dates,paste0(DIR,OUT, "\\tmy_dates"))
##aggregate solar/load data
list <- fread(paste0(DIR,IN,"optimization_list.csv"))
##aggregate solar/load data
list <- fread(paste0(DIR,IN,"\\optimization_list.csv"))
View(list)
#get tmy data
tmy <- fread(paste0(DIR,IN,"\\all_data\\BASE_", list[i,3],"_",list[i,4]))
#get tmy data
tmy <- fread(paste0(DIR,IN,"\\all_data\\BASE_", list[i,3],"_",list[i,4],".csv"))
View(tmy)
#merge on tmy_dates information
dates <- readRDS(paste0(DIR,OUT,"\\tmy_dates")
#merge on tmy_dates information
dates <- readRDS(paste0(DIR,OUT,"\\tmy_dates"))
#merge on tmy_dates information
dates <- readRDS(paste0(DIR,OUT,"\\tmy_dates"))
# Set working directory
DIR <- "C:\\Users\\Will\\GoogleDrive\\UCBerkeley\\Research\\Papers\\2018 Off-grid\\Analysis\\"
OUT <- "in\\res_solar"
IN <-  "in\\"
LD<- "LOW"
# Packages
library(pacman)
p_load(magrittr, dplyr, stringr, rjson, maps,maptools, spatstat,rgeos, broom, data.table)
# Set working directory
DIR <- "C:\\Users\\Will\\GoogleDrive\\UCBerkeley\\Research\\Papers\\2018 Off-grid\\Analysis\\"
OUT <- "in\\res_solar"
IN <-  "in\\"
LD<- "LOW"
i = 1
#create load dataframes
temp_low <- fread(paste0(DIR,IN,"res_load\\LOW\\", list[i,10],".csv"), col.names=c("V","load"))
temp_low <- do.call("rbind", replicate(9,temp_low, simplify = FALSE))
temp_med <- fread(paste0(DIR,IN,"res_load\\BASE\\", list[i,10],".csv"), col.names=c("V","load"))
temp_med <- do.call("rbind", replicate(9,temp_med, simplify = FALSE))
temp_high <- fread(paste0(DIR,IN,"res_load\\HIGH\\", list[i,10],".csv"), col.names=c("V","load"))
temp_high <- do.call("rbind", replicate(9,temp_high, simplify = FALSE))
#create solar dataframe
sol <- fread(paste0(DIR,IN,"sol_data\\", list[i,3],"_", list[i,4],".csv"))
#convert local to time element
sol$time <- as.POSIXct(strptime(sol$local_time_stor, "%Y-%m-%d %H:%M:%S"))
sol$year <- format(sol$time, "%Y")
sol$month <- format(sol$time, "%m")
sol$day <- format(sol$time, "%d")
sol$hour <- format(sol$time, "%H")
sol <- sol[,c(5,6,7,8,3)]
sol <- sol[complete.cases(sol), ]
#create appended table
year <- c("2008","2009","2010","2011","2012","2013","2014","2015","2016")
month <- c("03","03","03","03","03","03","03","03","03")
day <- c("09","08","14","13","11","10","09","08","13")
hour <- c("02","02","02","02","02","02","02","02","02")
generation <- c(0,0,0,0,0,0,0,0,0)
add <- data.frame(year,month,day,hour,generation)
sol<- rbind(sol,add)
#drop feb 29 data (maybe by dropping duplicates)
sol1 <- sol %>% group_by(year,month, day, hour) %>% summarise(gen = mean(generation))
##########################################################
## III. Combining input data #############################
##########################################################
list <- fread(paste0(DIR,IN,"optimization_list.csv"))
#create load dataframes
temp_low <- fread(paste0(DIR,IN,"res_load\\LOW\\", list[i,10],".csv"), col.names=c("V","load"))
temp_low <- do.call("rbind", replicate(9,temp_low, simplify = FALSE))
temp_med <- fread(paste0(DIR,IN,"res_load\\BASE\\", list[i,10],".csv"), col.names=c("V","load"))
temp_med <- do.call("rbind", replicate(9,temp_med, simplify = FALSE))
temp_high <- fread(paste0(DIR,IN,"res_load\\HIGH\\", list[i,10],".csv"), col.names=c("V","load"))
temp_high <- do.call("rbind", replicate(9,temp_high, simplify = FALSE))
#create solar dataframe
sol <- fread(paste0(DIR,IN,"sol_data\\", list[i,3],"_", list[i,4],".csv"))
#convert local to time element
sol$time <- as.POSIXct(strptime(sol$local_time_stor, "%Y-%m-%d %H:%M:%S"))
sol$year <- format(sol$time, "%Y")
sol$month <- format(sol$time, "%m")
sol$day <- format(sol$time, "%d")
sol$hour <- format(sol$time, "%H")
sol <- sol[,c(5,6,7,8,3)]
sol <- sol[complete.cases(sol), ]
#create appended table
year <- c("2008","2009","2010","2011","2012","2013","2014","2015","2016")
month <- c("03","03","03","03","03","03","03","03","03")
day <- c("09","08","14","13","11","10","09","08","13")
hour <- c("02","02","02","02","02","02","02","02","02")
generation <- c(0,0,0,0,0,0,0,0,0)
add <- data.frame(year,month,day,hour,generation)
sol<- rbind(sol,add)
#drop feb 29 data (maybe by dropping duplicates)
sol1 <- sol %>% group_by(year,month, day, hour) %>% summarise(gen = mean(generation))
#merge columns and write table
dt <- cbind(sol1[,c(1,2,5)], temp_med[,2])
#merge columns and write table
dt <- cbind(sol1[,c(1,2,3,5)], temp_med[,2])
list <- fread(paste0(DIR,IN,"optimization_list.csv"))
for (i in 1:nrow(list)) {
#create load dataframes
temp_low <- fread(paste0(DIR,IN,"res_load\\LOW\\", list[i,10],".csv"), col.names=c("V","load"))
temp_low <- do.call("rbind", replicate(9,temp_low, simplify = FALSE))
temp_med <- fread(paste0(DIR,IN,"res_load\\BASE\\", list[i,10],".csv"), col.names=c("V","load"))
temp_med <- do.call("rbind", replicate(9,temp_med, simplify = FALSE))
temp_high <- fread(paste0(DIR,IN,"res_load\\HIGH\\", list[i,10],".csv"), col.names=c("V","load"))
temp_high <- do.call("rbind", replicate(9,temp_high, simplify = FALSE))
#create solar dataframe
sol <- fread(paste0(DIR,IN,"sol_data\\", list[i,3],"_", list[i,4],".csv"))
#convert local to time element
sol$time <- as.POSIXct(strptime(sol$local_time_stor, "%Y-%m-%d %H:%M:%S"))
sol$year <- format(sol$time, "%Y")
sol$month <- format(sol$time, "%m")
sol$day <- format(sol$time, "%d")
sol$hour <- format(sol$time, "%H")
sol <- sol[,c(5,6,7,8,3)]
sol <- sol[complete.cases(sol), ]
#create appended table
year <- c("2008","2009","2010","2011","2012","2013","2014","2015","2016")
month <- c("03","03","03","03","03","03","03","03","03")
day <- c("09","08","14","13","11","10","09","08","13")
hour <- c("02","02","02","02","02","02","02","02","02")
generation <- c(0,0,0,0,0,0,0,0,0)
add <- data.frame(year,month,day,hour,generation)
sol<- rbind(sol,add)
#drop feb 29 data (maybe by dropping duplicates)
sol1 <- sol %>% group_by(year,month, day, hour) %>% summarise(gen = mean(generation))
#merge columns and write table
dt <- cbind(sol1[,c(1,2,3,5)], temp_med[,2])
write.csv(dt, paste0(DIR, IN,"all_data\\BASE_", list[i,3],"_", list[i,4],".csv"))
dt <- cbind(sol1[,c(1,2,3,5)], temp_high[,2])
write.csv(dt, paste0(DIR, IN,"all_data\\HIGH_", list[i,3],"_", list[i,4],".csv"))
dt <- cbind(sol1[,c(1,2,3,5)], temp_low[,2])
write.csv(dt, paste0(DIR, IN,"all_data\\LOW_", list[i,3],"_", list[i,4],".csv"))
}
for (i in 1:nrow(list)) {
#create load dataframes
temp_low <- fread(paste0(DIR,IN,"res_load\\LOW\\", list[i,10],".csv"), col.names=c("V","load"))
temp_low <- do.call("rbind", replicate(9,temp_low, simplify = FALSE))
temp_med <- fread(paste0(DIR,IN,"res_load\\BASE\\", list[i,10],".csv"), col.names=c("V","load"))
temp_med <- do.call("rbind", replicate(9,temp_med, simplify = FALSE))
temp_high <- fread(paste0(DIR,IN,"res_load\\HIGH\\", list[i,10],".csv"), col.names=c("V","load"))
temp_high <- do.call("rbind", replicate(9,temp_high, simplify = FALSE))
#create solar dataframe
sol <- fread(paste0(DIR,IN,"sol_data\\", list[i,3],"_", list[i,4],".csv"))
#convert local to time element
sol$time <- as.POSIXct(strptime(sol$local_time_stor, "%Y-%m-%d %H:%M:%S"))
sol$year <- format(sol$time, "%Y")
sol$month <- format(sol$time, "%m")
sol$day <- format(sol$time, "%d")
sol$hour <- format(sol$time, "%H")
sol <- sol[,c(5,6,7,8,3)]
sol <- sol[complete.cases(sol), ]
#create appended table
year <- c("2008","2009","2010","2011","2012","2013","2014","2015","2016")
month <- c("03","03","03","03","03","03","03","03","03")
day <- c("09","08","14","13","11","10","09","08","13")
hour <- c("02","02","02","02","02","02","02","02","02")
generation <- c(0,0,0,0,0,0,0,0,0)
add <- data.frame(year,month,day,hour,generation)
sol<- rbind(sol,add)
#drop feb 29 data (maybe by dropping duplicates)
sol1 <- sol %>% group_by(year,month, day, hour) %>% summarise(gen = mean(generation))
#merge columns and write table
dt <- cbind(sol1[,c(1,2,3,5)], temp_med[,2])
saveRDS(dt, paste0(DIR, IN,"all_data\\BASE_", list[i,3],"_", list[i,4]))
dt <- cbind(sol1[,c(1,2,3,5)], temp_high[,2])
saveRDS(dt, paste0(DIR, IN,"all_data\\HIGH_", list[i,3],"_", list[i,4]))
dt <- cbind(sol1[,c(1,2,3,5)], temp_low[,2])
saveRDS(dt, paste0(DIR, IN,"all_data\\LOW_", list[i,3],"_", list[i,4]))
}
library(pacman)
p_load(magrittr, dplyr, stringr, ggplot2,data.table, ggmap, usmap, mapproj)
# Set working directory
DIR <- "C:\\Users\\Will\\GoogleDrive\\UCBerkeley\\Research\\Papers\\2018 Off-grid\\Analysis\\"
OUT = "out"
IN = "in"
i = 1
##aggregate solar/load data
list <- fread(paste0(DIR,IN,"\\optimization_list.csv"))
collect <- vector("list",length(list))
#get tmy data
data <- readRDS(paste0(DIR,IN,"\\all_data\\BASE_", list[i,3],"_",list[i,4]))
View(data)
#get tmy data
data <- as.Data.Frame(readRDS(paste0(DIR,IN,"\\all_data\\BASE_", list[i,3],"_",list[i,4])))
#get tmy data
data <- data.frame(readRDS(paste0(DIR,IN,"\\all_data\\BASE_", list[i,3],"_",list[i,4])))
View(data)
#merge on tmy_dates information
dates <- readRDS(paste0(DIR,OUT,"\\tmy_dates"))
View(dates)
# Packages
library(pacman)
p_load(magrittr, dplyr, stringr, rjson, maps,maptools, spatstat,rgeos, broom, data.table)
# Set working directory
DIR <- "C:\\Users\\Will\\GoogleDrive\\UCBerkeley\\Research\\Papers\\2018 Off-grid\\Analysis\\"
OUT <- "in\\res_solar"
IN <-  "in\\"
LD<- "LOW"
i = 1
##########################################################
## III. Combining input data #############################
##########################################################
list <- fread(paste0(DIR,IN,"optimization_list.csv"))
#create load dataframes
temp_low <- fread(paste0(DIR,IN,"res_load\\LOW\\", list[i,10],".csv"), col.names=c("V","load"))
temp_low <- do.call("rbind", replicate(9,temp_low, simplify = FALSE))
temp_med <- fread(paste0(DIR,IN,"res_load\\BASE\\", list[i,10],".csv"), col.names=c("V","load"))
temp_med <- do.call("rbind", replicate(9,temp_med, simplify = FALSE))
temp_high <- fread(paste0(DIR,IN,"res_load\\HIGH\\", list[i,10],".csv"), col.names=c("V","load"))
temp_high <- do.call("rbind", replicate(9,temp_high, simplify = FALSE))
#create solar dataframe
sol <- fread(paste0(DIR,IN,"sol_data\\", list[i,3],"_", list[i,4],".csv"))
#convert local to time element
sol$time <- as.POSIXct(strptime(sol$local_time_stor, "%Y-%m-%d %H:%M:%S"))
sol$year <- format(sol$time, "%Y")
sol$month <- format(sol$time, "%m")
sol$day <- format(sol$time, "%d")
sol$hour <- format(sol$time, "%H")
sol <- sol[,c(5,6,7,8,3)]
sol <- sol[complete.cases(sol), ]
#create appended table
year <- c("2008","2009","2010","2011","2012","2013","2014","2015","2016")
month <- c("03","03","03","03","03","03","03","03","03")
day <- c("09","08","14","13","11","10","09","08","13")
hour <- c("02","02","02","02","02","02","02","02","02")
generation <- c(0,0,0,0,0,0,0,0,0)
add <- data.frame(year,month,day,hour,generation)
sol<- rbind(sol,add)
#drop feb 29 data (maybe by dropping duplicates)
sol1 <- sol %>% group_by(year,month, day, hour) %>% summarise(gen = mean(generation))
#merge columns and write table
dt <- cbind(sol1[,c(1,2,3,5)], temp_med[,2])
View(dt)
sol1[,c(1,2,3,5)
sol1[,c(1,2,3,5)]
sol1[,c(1,2,3,5)]
temp_med[,2]
sol1 <- sol1[,c(1,2,3,5)]
View(sol1)
#merge columns and write table
dt <- cbind(sol1, temp_med[,2])
sol1 <- sol1[,5] #1,2,3,
sol1 <- sol1[,4] #1,2,3,
#merge columns and write table
dt <- cbind(sol1, temp_med[,2])
#drop feb 29 data (maybe by dropping duplicates)
sol1 <- sol %>% group_by(year,month, day, hour) %>% summarise(gen = mean(generation))
sol1 <- sol1[,c(4,2)] #1,2,3,
#merge columns and write table
dt <- cbind(sol1, temp_med[,2])
#drop feb 29 data (maybe by dropping duplicates)
sol1 <- sol %>% group_by(year,month, day, hour) %>% summarise(gen = mean(generation))
sol1 <- sol1[,c(1,2,3,5)] #1,2,3,
#merge columns and write table
dt <- cbind(sol1, temp_med[,2])
sol1 <- lapply(sol1, function(x) as.numeric(as.character(x)))
sol1 <- data.frame(lapply(sol1, function(x) as.numeric(as.character(x))))
#drop feb 29 data (maybe by dropping duplicates)
sol1 <- sol %>% group_by(year,month, day, hour) %>% summarise(gen = mean(generation))
sol1 <- data.frame(lapply(sol1, function(x) as.numeric(as.character(x))))
View(sol1)
#merge columns and write table
dt <- cbind(sol1[,c(1,2,3,5)], temp_med[,2])
list <- fread(paste0(DIR,IN,"optimization_list.csv"))
for (i in 1:nrow(list)) {
#create load dataframes
temp_low <- fread(paste0(DIR,IN,"res_load\\LOW\\", list[i,10],".csv"), col.names=c("V","load"))
temp_low <- do.call("rbind", replicate(9,temp_low, simplify = FALSE))
temp_med <- fread(paste0(DIR,IN,"res_load\\BASE\\", list[i,10],".csv"), col.names=c("V","load"))
temp_med <- do.call("rbind", replicate(9,temp_med, simplify = FALSE))
temp_high <- fread(paste0(DIR,IN,"res_load\\HIGH\\", list[i,10],".csv"), col.names=c("V","load"))
temp_high <- do.call("rbind", replicate(9,temp_high, simplify = FALSE))
#create solar dataframe
sol <- fread(paste0(DIR,IN,"sol_data\\", list[i,3],"_", list[i,4],".csv"))
#convert local to time element
sol$time <- as.POSIXct(strptime(sol$local_time_stor, "%Y-%m-%d %H:%M:%S"))
sol$year <- format(sol$time, "%Y")
sol$month <- format(sol$time, "%m")
sol$day <- format(sol$time, "%d")
sol$hour <- format(sol$time, "%H")
sol <- sol[,c(5,6,7,8,3)]
sol <- sol[complete.cases(sol), ]
#create appended table
year <- c("2008","2009","2010","2011","2012","2013","2014","2015","2016")
month <- c("03","03","03","03","03","03","03","03","03")
day <- c("09","08","14","13","11","10","09","08","13")
hour <- c("02","02","02","02","02","02","02","02","02")
generation <- c(0,0,0,0,0,0,0,0,0)
add <- data.frame(year,month,day,hour,generation)
sol<- rbind(sol,add)
#drop feb 29 data (maybe by dropping duplicates)
sol1 <- sol %>% group_by(year,month, day, hour) %>% summarise(gen = mean(generation))
sol1 <- data.frame(lapply(sol1, function(x) as.numeric(as.character(x))))
#merge columns and write table
dt <- cbind(sol1[,c(1,2,3,5)], temp_med[,2])
saveRDS(dt, paste0(DIR, IN,"all_data\\BASE_", list[i,3],"_", list[i,4]))
dt <- cbind(sol1[,c(1,2,3,5)], temp_high[,2])
saveRDS(dt, paste0(DIR, IN,"all_data\\HIGH_", list[i,3],"_", list[i,4]))
dt <- cbind(sol1[,c(1,2,3,5)], temp_low[,2])
saveRDS(dt, paste0(DIR, IN,"all_data\\LOW_", list[i,3],"_", list[i,4]))
}
i
View(temp_high)
temp_high <- fread(paste0(DIR,IN,"res_load\\HIGH\\", list[i,10],".csv"), col.names=c("V","load"))
View(temp_high)
View(list)
##load in lat long for solar
sol_data <- fread(paste0(DIR,IN,"solar_list.csv"))
cord1 <- sol_data[,c(4,3)]
#load in lat long for tmy3
tmy_data <- fromJSON(file = paste0(DIR,IN,"\\tmy3_lat_lng.json"))
names <- data.frame(names(tmy_data))
tmy_coor <- data.frame(matrix(unlist(tmy_data), nrow = 1020, byrow=T))
tmy_coor <-cbind(names, tmy_coor)
colnames(tmy_coor) <- c("ID", "lat","long")
tmy_coor$ID <- as.numeric(levels(tmy_coor$ID))[tmy_coor$ID]
View(tmy_coor)
##get IDs of actual load data
load_data <- fread(paste0(DIR,IN,"id.csv"))
load_data <- merge(load_data, tmy_coor, by="ID")
load_data$row_in_2 <- as.numeric(row.names(load_data))
View(load_data)
load_data <- load_data[which(load_data$ID!= 724365 & load_data$ID!= 724935 & load_data$ID!= 725477), ]
#pull out the coords
cord2 <- load_data[,c(3,2)]
#find nearest load to solar data
set1sp <- SpatialPoints(cord1)
set2sp <- SpatialPoints(cord2)
sol_data$row_in_2 <- apply(gDistance(set2sp, set1sp, byid=TRUE), 1, which.min)
##connect to the ID
final <- merge(sol_data, load_data, by="row_in_2")
View(final)
View(load_data)
View(sol_data)
##get IDs of actual load data
load_data <- fread(paste0(DIR,IN,"id.csv"))
load_data <- load_data[which(load_data$ID!= 724365 & load_data$ID!= 724935 & load_data$ID!= 725477), ]
load_data <- merge(load_data, tmy_coor, by="ID")
load_data$row_in_2 <- as.numeric(row.names(load_data))
sol_data <- fread(paste0(DIR,IN,"solar_list.csv"))
cord1 <- sol_data[,c(4,3)]
##load in lat long for tmy3
tmy_data <- fromJSON(file = paste0(DIR,IN,"\\tmy3_lat_lng.json"))
names <- data.frame(names(tmy_data))
tmy_coor <- data.frame(matrix(unlist(tmy_data), nrow = 1020, byrow=T))
tmy_coor <-cbind(names, tmy_coor)
colnames(tmy_coor) <- c("ID", "lat","long")
tmy_coor$ID <- as.numeric(levels(tmy_coor$ID))[tmy_coor$ID]
##get IDs of actual load data
load_data <- fread(paste0(DIR,IN,"id.csv"))
load_data <- load_data[which(load_data$ID!= 724365 & load_data$ID!= 724935 & load_data$ID!= 725477), ]
load_data <- merge(load_data, tmy_coor, by="ID")
load_data$row_in_2 <- as.numeric(row.names(load_data))
#pull out the coords
cord2 <- load_data[,c(3,2)]
#find nearest load to solar data
set1sp <- SpatialPoints(cord1)
set2sp <- SpatialPoints(cord2)
sol_data$row_in_2 <- apply(gDistance(set2sp, set1sp, byid=TRUE), 1, which.min)
##connect to the ID
final <- merge(sol_data, load_data, by="row_in_2")
View(final)
#output
write.csv(final,paste0(DIR, IN,"optimization_list.csv"))
list <- fread(paste0(DIR,IN,"optimization_list.csv"))
for (i in 1:nrow(list)) {
#create load dataframes
temp_low <- fread(paste0(DIR,IN,"res_load\\LOW\\", list[i,10],".csv"), col.names=c("V","load"))
temp_low <- do.call("rbind", replicate(9,temp_low, simplify = FALSE))
temp_med <- fread(paste0(DIR,IN,"res_load\\BASE\\", list[i,10],".csv"), col.names=c("V","load"))
temp_med <- do.call("rbind", replicate(9,temp_med, simplify = FALSE))
temp_high <- fread(paste0(DIR,IN,"res_load\\HIGH\\", list[i,10],".csv"), col.names=c("V","load"))
temp_high <- do.call("rbind", replicate(9,temp_high, simplify = FALSE))
#create solar dataframe
sol <- fread(paste0(DIR,IN,"sol_data\\", list[i,3],"_", list[i,4],".csv"))
#convert local to time element
sol$time <- as.POSIXct(strptime(sol$local_time_stor, "%Y-%m-%d %H:%M:%S"))
sol$year <- format(sol$time, "%Y")
sol$month <- format(sol$time, "%m")
sol$day <- format(sol$time, "%d")
sol$hour <- format(sol$time, "%H")
sol <- sol[,c(5,6,7,8,3)]
sol <- sol[complete.cases(sol), ]
#create appended table
year <- c("2008","2009","2010","2011","2012","2013","2014","2015","2016")
month <- c("03","03","03","03","03","03","03","03","03")
day <- c("09","08","14","13","11","10","09","08","13")
hour <- c("02","02","02","02","02","02","02","02","02")
generation <- c(0,0,0,0,0,0,0,0,0)
add <- data.frame(year,month,day,hour,generation)
sol<- rbind(sol,add)
#drop feb 29 data (maybe by dropping duplicates)
sol1 <- sol %>% group_by(year,month, day, hour) %>% summarise(gen = mean(generation))
sol1 <- data.frame(lapply(sol1, function(x) as.numeric(as.character(x))))
#merge columns and write table
dt <- cbind(sol1[,c(1,2,3,5)], temp_med[,2])
saveRDS(dt, paste0(DIR, IN,"all_data\\BASE_", list[i,3],"_", list[i,4]))
dt <- cbind(sol1[,c(1,2,3,5)], temp_high[,2])
saveRDS(dt, paste0(DIR, IN,"all_data\\HIGH_", list[i,3],"_", list[i,4]))
dt <- cbind(sol1[,c(1,2,3,5)], temp_low[,2])
saveRDS(dt, paste0(DIR, IN,"all_data\\LOW_", list[i,3],"_", list[i,4]))
}
### call libraries
p_load(dplyr,magrittr, reshape2)
### call libraries
p_load(dplyr,magrittr, reshape2)
### Set DG Customer-specific directories
DIR <- getwd()
DIR
